<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <title>JumpNads - Jump to the MOON!</title>
    
    <!-- IMAGE BLOCKER: Block specific control button images from loading -->
    <script>
      (function blockTouchButtonImages() {
        console.log('üõ°Ô∏è Setting up button image blocker');
        
        // Create a style element to hide these specific images
        const style = document.createElement('style');
        style.id = 'specific-image-blocker';
        style.textContent = `
          /* Block the specific touch control images */
          img[src*="left_arrow.png"],
          img[src*="right_arrow.png"],
          img[src*="shoot.png"],
          [style*="background-image: url("][style*="left_arrow.png"],
          [style*="background-image: url("][style*="right_arrow.png"],
          [style*="background-image: url("][style*="shoot.png"] {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
            position: absolute !important;
            left: -9999px !important;
            top: -9999px !important;
            height: 0 !important;
            width: 0 !important;
            z-index: -9999 !important;
          }
        `;
        document.head.appendChild(style);
        
        // Set up interception for image loading
        const imageTargets = ['left_arrow.png', 'right_arrow.png', 'shoot.png'];
        
        // Intercept image loading
        const originalImageProto = window.Image.prototype;
        const originalSrcDescriptor = Object.getOwnPropertyDescriptor(originalImageProto, 'src');
        
        if (originalSrcDescriptor && originalSrcDescriptor.set) {
          Object.defineProperty(originalImageProto, 'src', {
            set: function(value) {
              // Check if this is one of the targeted images
              if (value && typeof value === 'string') {
                for (const target of imageTargets) {
                  if (value.includes(target)) {
                    console.log(`üö´ Blocked loading of ${target}`);
                    // Set to a transparent pixel instead
                    return originalSrcDescriptor.set.call(
                      this, 
                      'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'
                    );
                  }
                }
              }
              return originalSrcDescriptor.set.call(this, value);
            },
            get: originalSrcDescriptor.get
          });
          console.log('‚úÖ Successfully set up image loading interception');
        }
        
        // Also intercept XMLHttpRequest to block loading of these image files
        const originalOpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
          if (url && typeof url === 'string') {
            for (const target of imageTargets) {
              if (url.includes(target)) {
                console.log(`üö´ Blocked XHR request for ${target}`);
                // Call with a non-existent URL to cause a harmless error
                return originalOpen.call(this, method, 'non-existent-file.png', async, user, password);
              }
            }
          }
          return originalOpen.call(this, method, url, async, user, password);
        };
        
        // Block fetch requests for these images
        const originalFetch = window.fetch;
        window.fetch = function(resource, init) {
          if (resource && typeof resource === 'string') {
            for (const target of imageTargets) {
              if (resource.includes(target)) {
                console.log(`üö´ Blocked fetch request for ${target}`);
                // Return a resolved promise with a transparent image
                return Promise.resolve(
                  new Response(
                    'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',
                    { status: 200, statusText: 'OK', headers: new Headers({ 'Content-Type': 'image/gif' }) }
                  )
                );
              }
            }
          }
          return originalFetch.call(this, resource, init);
        };
        
        // Create a MutationObserver to remove any of these images that get added dynamically
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.addedNodes && mutation.addedNodes.length) {
              for (let i = 0; i < mutation.addedNodes.length; i++) {
                const node = mutation.addedNodes[i];
                
                // Check if it's an IMG element
                if (node.tagName === 'IMG' && node.src) {
                  for (const target of imageTargets) {
                    if (node.src.includes(target)) {
                      console.log(`Removing dynamically added ${target} image`);
                      node.remove();
                      break;
                    }
                  }
                }
              }
            }
          });
        });
        
        // Start observing when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
          observer.observe(document.body, { 
            childList: true, 
            subtree: true 
          });
        });
        
        console.log('üõ°Ô∏è Button image blocker initialized');
      })();
    </script>
    
    <!-- CRITICAL: Immediately hide all mobile controls in desktop mode -->
    <style id="desktop-control-blocker">
      /* Hide all control buttons in desktop mode with extreme prejudice */
      #shoot-btn, 
      #left-btn, 
      #right-btn, 
      #mobile-controls-overlay, 
      #mobile-controls, 
      #ultra-stable-controls,
      #stable-controls,
      img[src*="left_arrow.png"],
      img[src*="right_arrow.png"],
      img[src*="shoot.png"],
      div[style*="z-index: 10000"],
      div[style*="z-index:10000"],
      [style*="position: fixed"][style*="bottom: 30px"],
      [style*="position:fixed"][style*="bottom:30px"],
      [style*="position: fixed"][style*="z-index: 2147483647"],
      [style*="position:fixed"][style*="z-index:2147483647"] {
        display: none !important;
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
        position: absolute !important;
        left: -9999px !important;
        top: -9999px !important;
        height: 0 !important;
        width: 0 !important;
        z-index: -9999 !important;
      }
      
      /* Target specific SHOOT button text */
      *:contains('SHOOT') {
        display: none !important;
      }
    </style>
    
    <script>
      // Immediately check if this is desktop and enable control blocking
      (function blockControlsOnDesktop() {
        const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isInIframe = window.self !== window.top;
        window.isDesktopMode = !(isInIframe || isMobileDevice);
        
        // Add class to html element to enable CSS targeting
        if (window.isDesktopMode) {
          document.documentElement.classList.add('desktop-mode');
          
          // Set interval to periodically remove any control buttons
          setInterval(function() {
            const controlElements = document.querySelectorAll('#shoot-btn, #left-btn, #right-btn, [src*="shoot.png"], [src*="left_arrow.png"], [src*="right_arrow.png"]');
            controlElements.forEach(function(element) {
              element.remove();
            });
          }, 500);
        } else {
          document.documentElement.classList.add('mobile-mode');
        }
      })();
    </script>
    
    <!-- Mobile persistence script -->
    <script>
      (function forceMobileView() {
        // Check if we're on mobile
        if (window.innerWidth <= 768) {
          // Set global markers
          window.__FORCE_MOBILE_VIEW__ = true;
          localStorage.setItem('isMobileDevice', 'true');
          sessionStorage.setItem('isMobileDevice', 'true');
          
          // Set URL parameter if needed
          const urlParams = new URLSearchParams(window.location.search);
          if (!urlParams.has('isMobile')) {
            urlParams.set('isMobile', 'true');
            const newUrl = window.location.pathname + '?' + urlParams.toString() + window.location.hash;
            window.history.replaceState({}, '', newUrl);
          }
          
          // Force reload if needed
          const checkMobileView = function() {
            if (window.__FORCE_MOBILE_VIEW__ && document.body && !document.querySelector('.mobile-container')) {
              const urlParams = new URLSearchParams(window.location.search);
              urlParams.set('isMobile', 'true');
              urlParams.set('t', Date.now()); // Cache buster
              const newUrl = window.location.pathname + '?' + urlParams.toString() + window.location.hash;
              window.location.href = newUrl;
            }
          };
          
          // Check after DOM loads and on visibility change
          document.addEventListener('DOMContentLoaded', checkMobileView);
          document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
              setTimeout(checkMobileView, 50);
            }
          });
          
          // Force check when wallet is connected
          if (window.ethereum) {
            // Direct event listeners
            window.ethereum.on('connect', function() {
              console.log('Wallet connected - checking mobile state');
              setTimeout(checkMobileView, 100);
              setTimeout(checkMobileView, 500); // Double check after a delay
            });
            
            window.ethereum.on('accountsChanged', function() {
              console.log('Accounts changed - checking mobile state');
              setTimeout(checkMobileView, 100);
              setTimeout(checkMobileView, 500); // Double check after a delay
            });
          }
          
          // Create a MutationObserver to watch for DOM changes
          const observer = new MutationObserver(function(mutations) {
            // If app structure changes, verify we're still in mobile mode
            setTimeout(checkMobileView, 50);
          });
          
          document.addEventListener('DOMContentLoaded', function() {
            if (document.body) {
              observer.observe(document.body, { 
                childList: true, 
                subtree: true 
              });
            }
          });
          
          // Intercept wallet methods
          const originalEthereum = window.ethereum;
          if (originalEthereum) {
            // Preserve the original request method
            const originalRequest = originalEthereum.request;
            
            // Replace with our wrapped version
            originalEthereum.request = function(request) {
              console.log('Ethereum request intercepted:', request?.method);
              
              // Capture the original promise
              const result = originalRequest.call(this, request);
              
              // Add our check after wallet interactions
              if (request && request.method && 
                 (request.method.includes('connect') || 
                  request.method.includes('account'))) {
                console.log('Wallet method detected:', request.method);
                
                // Run multiple checks after wallet operations
                setTimeout(checkMobileView, 100);
                setTimeout(checkMobileView, 500);
                setTimeout(checkMobileView, 1500);
              }
              
              return result;
            };
          }
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html> 